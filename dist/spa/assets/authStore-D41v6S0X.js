import{c as p,A as S,r as s,o as x,w as A,V as b}from"./index-O9lBOlJo.js";import{api as d}from"./axios-CN2gCQBP.js";const _={dark:{type:Boolean,default:null}};function T(e,t){return p(()=>e.dark===null?t.dark.isActive:e.dark)}let i=[],l=[];function w(e){l=l.filter(t=>t!==e)}function $(e){w(e),l.push(e)}function D(e){w(e),l.length===0&&i.length!==0&&(i[i.length-1](),i=[])}function E(e){l.length===0?e():i.push(e)}function P(e){i=i.filter(t=>t!==e)}let f,c=0;const a=new Array(256);for(let e=0;e<256;e++)a[e]=(e+256).toString(16).substring(1);const I=(()=>{const e=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(e!==void 0){if(e.randomBytes!==void 0)return e.randomBytes;if(e.getRandomValues!==void 0)return t=>{const n=new Uint8Array(t);return e.getRandomValues(n),n}}return t=>{const n=[];for(let o=t;o>0;o--)n.push(Math.floor(Math.random()*256));return n}})(),y=4096;function v(){(f===void 0||c+16>y)&&(c=0,f=I(y));const e=Array.prototype.slice.call(f,c,c+=16);return e[6]=e[6]&15|64,e[8]=e[8]&63|128,a[e[0]]+a[e[1]]+a[e[2]]+a[e[3]]+"-"+a[e[4]]+a[e[5]]+"-"+a[e[6]]+a[e[7]]+"-"+a[e[8]]+a[e[9]]+"-"+a[e[10]]+a[e[11]]+a[e[12]]+a[e[13]]+a[e[14]]+a[e[15]]}function B(e){return e??null}function h(e,t){return e??(t===!0?`f_${v()}`:null)}function W({getValue:e,required:t=!0}={}){if(S.value===!0){const n=e!==void 0?s(B(e())):s(null);return t===!0&&n.value===null&&x(()=>{n.value=`f_${v()}`}),e!==void 0&&A(e,o=>{n.value=h(o,t)}),n}return e!==void 0?p(()=>h(e(),t)):s(`f_${v()}`)}class M{async login(t){return await d.post("/login",t)}async getUser(){return await d.get("/user")}async logout(){return await d.get("/logout")}}const g=new M,C=b("auth",()=>{const e=s(null),t=s(localStorage.getItem("authToken"))||null,n=s(!1),o=s("");async function k(r){o.value="";try{const u=await g.login(r);return t.value=u.data.token,e.value=u.data.user,n.value=!0,localStorage.setItem("authToken",u.data.token),await m(),{success:!0,data:u.data}}catch(u){return o.value=u.userMessage,{success:!1,error:u}}}async function m(){o.value="";try{const r=await g.getUser();return e.value={id:r.data.id,name:r.data.name,email:r.data.email,role:r.data.role,image:r.data.image},{success:!0,data:r.data}}catch(r){return o.value=r.userMessage,{success:!1,error:r}}}async function F(){await g.logout(),t.value=null,e.value=null,n.value=!1,localStorage.removeItem("authToken")}return{user:e,token:t,isAuthenticated:n,errorMessage:o,login:k,getUser:m,logout:F}});export{C as a,_ as b,T as c,E as d,$ as e,P as f,D as r,W as u};
